<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css"
          type="text/css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/railscasts.min.css"
          rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery.address/1.6/jquery.address.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <style>
      

body {
  font-family: "Open Sans", "Helvetica", "Helvetica Neue",  "Arial", sans-serif;
  font-size:90%;
  color: black;
}

p {
  margin: 0.5em;
}

pre code {
  font-family: "Monaco";
  font-size: 100%;
}

img {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin:10px;
}

h1, h2, h3 {
  border-bottom:thin solid black;
  margin-bottom: 0.5em;
  margin-top: 1em;
}

h1 {
  font-style:italic;
  font-size:130%;
}

h2 {
  font-size:110%;
}

h3 {
  font-size:100%;
}



      

html, body {
  height: 100%;
  margin: 0;
}
.wrapper {
  height: 100%;
  display: flex;
  flex-direction: column;
}
.footer {
  background: white;
  text-align: right;
}
.content {
  flex: 1;
  overflow: auto;
}



    </style>
  </head>

  
  

  <div class="ui fixed top pointing inverted stackable menu labmenu">
    <header class="header item">
      <i id="toc" class="sitemap icon"></i>
      
        <a href="../../index.html">  10a: Persistence (XML)  </a>
      
    </header>
    <div class="right tab-menu menu">
      
        <a class="item" data-tab="Lab-10a">
          Lab-10a
        </a>
      
        <a class="item" data-tab="01">
          01
        </a>
      
        <a class="item" data-tab="02">
          02
        </a>
      
        <a class="item" data-tab="Solutions">
          Solutions
        </a>
      
    </div>
  </div>


  

  <div class="ui pushable">
    <div class="ui inverted labeled icon left inline vertical sidebar menu">
      <br><br>
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic----assignments/book-assignment-1/index.html">Assignment-1 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic----assignments/book-assignment-2/index.html">Assignment-2 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-00-induction/book-induction/index.html">Induction </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-01-first-contact/unit-01a-intro-to-processing/book-1a/index.html">Lab-1a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-01-first-contact/unit-01b-animate-your-drawings/book-1b/index.html">Lab-1b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-02-selection_and_iteration/unit-02a-if-stmt-and-events/book/index.html">Lab-02a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-02-selection_and_iteration/unit-02b-iteration-for-while/book/index.html">Lab-02b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-03-methods/unit-03a-methods/book/index.html">Lab-03a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-03-methods/unit-03b-more-on-methods/book/index.html">Lab-03b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-04-classes/unit-04a-strings-and-intro-to-classes/book/index.html">Lab-04a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-04-classes/unit-04b-classes-encapsulation/book/index.html">Lab-04b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-05-arrays/unit-05a-swing-and-arrays/book/index.html">Lab-05a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-05-arrays/unit-05b-arrays-and-classes/book/index.html">Lab-05b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-06-pong/unit-06a-pong-V1-V5/book-v1-v5/index.html">Lab-06a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-06-pong/unit-06b-pong-v6/book-v6/index.html">Lab-06b-v6 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-06-pong/unit-06b-pong-v7/book-v7/index.html">Lab-06b-v7 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-06-pong/unit-06b-pong-v8/book-v6-v7-v8/index.html">Lab-06b-v8 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-06-pong/unit-06b-pong-v9/book-v9/index.html">Lab-06b-v9 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-07-IntelliJ-JVM-and-IO/unit-07a/book-a-setup-intellij/index.html">Lab-07a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-07-IntelliJ-JVM-and-IO/unit-07b/book-b/index.html">Lab-07b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-08-grouping-objects/unit-01/book-1/index.html">Lab-08a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-08-grouping-objects/unit-01/book-2/index.html">Lab-08b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-09-menu-and-crud/unit-01/book-1/index.html">Lab-09a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-09-menu-and-crud/unit-01b/book-4/index.html">Assignment 3 Prerequisite </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-09-menu-and-crud/unit-02/book-2/index.html">Lab-09c </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-10-persistence-xml-exceptions/unit-01/book/index.html">Lab-10a </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-10-persistence-xml-exceptions/unit-02/book/index.html">Lab-10b </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-11-inher-polym/unit-01/book/index.html">Lab-11 </a>
          
        
      
        
          
            <a class="item"
               href="http://wit-hdip-comp-sci-2019.github.io/programming//topic-11-inher-polym/unit-02/book2/index.html">Lab-11 </a>
          
        
      
    </div>
    <div class="pusher" tabindex="-1">
      <div class="ui basic segment">
        <br>
        
          <div class="ui tab segment lab" data-tab="Lab-10a">
            <h1>Objectives</h1>
<p>XML · Exception Handling · Validate User Input · ShopV5.0 · DVD3.0</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="01">
            <h1>Developing Shop V5.0</h1>
<p>In this practical, you will create a new project called ShopV5.0, based on ShopV4.0.  You will update the Driver, Store and Product classes (linked below) to enable the user to save the products to an XML file and also reload them (see Figure 1 for the updated menu system).</p>
<p><img src="./img/00.png" alt="Figure 1: Menu System for ShopV5.0"> </p>
<h2>Menu Items 9 and 10:  Saving and Loading Products</h2>
<p>Create a new project called ShopV5.0.</p>
<p>Copy the following classes into the project:</p>
<ul>
<li><p><a href="archives/Driver.java">Driver.java</a></p>
</li>
<li><p><a href="archives/Store.java">Store.java</a></p>
</li>
<li><p><a href="archives/Product.java">Product.java</a></p>
</li>
</ul>
<h2>Setting up the Component for Serializing</h2>
<p>Download the following XStream jar file from:</p>
<p><strong>UPDATE: use XSTREAM 1.4.11.1 jar file instead</strong></p>
<ul>
<li><a href="archives/xstream-1.4.10.jar">xstream-1.4.10.jar</a> </li>
</ul>
<p>In IntelliJ, on the ShopV5.0 project, right click and select <strong>New</strong>, followed by <strong>Directory</strong>.  Call the new directory <strong>lib</strong>.  Drag the xstream jar file already downloaded into the lib folder.</p>
<p>Your workspace should look like this:</p>
<p><img src="img/xml01.png" alt=""></p>
<p>From <strong>File</strong> menu, select <strong>Project Structure</strong>.  Click on <strong>Libraries</strong>.  To add a library to your build path, click on the green + : </p>
<p><img src="img/xml02.png" alt=""></p>
<p>Select Java and locate your library…click OK (a few times!).</p>
<h2>Updating Store Class to serialize and deserialize products</h2>
<p>In the Store class, create these two new methods:</p>
<pre><code class="lang-java">    @SuppressWarnings(&quot;unchecked&quot;)
    public void load() throws Exception
    {
        XStream xstream = new XStream(new DomDriver());
        ObjectInputStream is = xstream.createObjectInputStream(new FileReader(&quot;products.xml&quot;));
        products = (ArrayList&lt;Product&gt;) is.readObject();
        is.close();
    }

    public void save() throws Exception
    {
        XStream xstream = new XStream(new DomDriver());
        ObjectOutputStream out = xstream.createObjectOutputStream(new FileWriter(&quot;products.xml&quot;));
        out.writeObject(products);
        out.close();    
    }</code></pre>
<p>You will notice that they don&#39;t compile; they are missing some needed packages.  Import the following packages at the top of the store class:</p>
<pre><code class="lang-java">import java.io.FileReader;
import java.io.FileWriter;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;

import com.thoughtworks.xstream.XStream;
import com.thoughtworks.xstream.io.xml.DomDriver;</code></pre>
<h2>Adding load and save functionality to the menu</h2>
<p>In the Driver class, add options 9 and 10 to the printed menu:</p>
<p><img src="./img/03.png" alt="Figure 4: Menu System code for Shop V5.0"> </p>
<p>In the Driver class, make the following changes to implement case 9 and 10: </p>
<p><img src="./img/04.png" alt="Figure 5: Code for case 9 and 10"> </p>
<h2>Testing the load and store</h2>
<p>You should be in a position now to test.  </p>
<p>Start your app and create two products e.g.</p>
<pre><code>Please enter the product description: 24 inch monitor
Please enter the product code: 3423
Please enter the product cost: 129.99
Is this product in your current line (y/n): y

Please enter the product description: 14 inch monitor
Please enter the product code: 2322
Please enter the product cost: 109.99
Is this product in your current line (y/n): y</code></pre>
<p>Now try option 9 to save your products. <strong>Note: if you are using java 9 you are probably getting a series of red warning messages...the products will be saved, but they will still produce the warnings.  The next step will show you how to suppress these warnings</strong>.<br>You should now see a products.xml file appearing in the root of your project.  </p>
<p>Open this file and it should contain something similar to this:</p>
<pre><code class="lang-xml">&lt;object-stream&gt;
  &lt;list&gt;
    &lt;Product&gt;
      &lt;productName&gt;24 inch monitor&lt;/productName&gt;
      &lt;productCode&gt;3423&lt;/productCode&gt;
      &lt;unitCost&gt;129.99&lt;/unitCost&gt;
      &lt;inCurrentProductLine&gt;true&lt;/inCurrentProductLine&gt;
    &lt;/Product&gt;
    &lt;Product&gt;
      &lt;productName&gt;14 inch monitor&lt;/productName&gt;
      &lt;productCode&gt;2322&lt;/productCode&gt;
      &lt;unitCost&gt;109.99&lt;/unitCost&gt;
      &lt;inCurrentProductLine&gt;true&lt;/inCurrentProductLine&gt;
    &lt;/Product&gt;
  &lt;/list&gt;
&lt;/object-stream&gt;</code></pre>
<p>Exit your application and run it again.</p>
<p>Test option 10 and make sure that the saved products are loaded back into your products ArrayList correctly.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="02">
            <h1>Java 9 and XStream</h1>
<p><em>This step ONLY applies if you are using JDK9.  If you are using JDK8 or lower, you can move onto the next step.  Chances are the majority of you are using JDK8.</em></p>
<p>If you are using JDK9, you are more than likely getting the following warning when saving your products:</p>
<p><img src="./img/error01.png" alt="Warning when saving XML file with JDK9">  </p>
<p>However, your products.xml file will still be successfully saved; it is just a warning. </p>
<h2>Getting rid of the warning</h2>
<p>We can get rid of the warning by passing suppression messages to the VM when we run our application. To do this:</p>
<ul>
<li><p>From the <strong>Run</strong> menu, select <strong>Edit Configuratons...*</strong></p>
</li>
<li><p>In the <strong>VM Options</strong> box, paste in the following VM arguments:</p>
</li>
</ul>
<pre><code>--add-opens java.base/java.util=ALL-UNNAMED 
--add-opens java.base/java.lang.reflect=ALL-UNNAMED 
--add-opens java.base/java.text=ALL-UNNAMED 
--add-opens java.desktop/java.awt.font=ALL-UNNAMED</code></pre>
<ul>
<li>Click the <strong>OK</strong> button.  </li>
</ul>
<h2>Retesting</h2>
<p>Rerun the app and try the save again...the warning message should now be suppresed.</p>
<h2>A note on XStream and Java</h2>
<p>Java 9 was released in September 2017.  However, the latest version of XStream (1.4.10) was released in May 2017, before the latest Java changes.  When a new version of XStream is released, we probably won&#39;t have to pass these parameters to the VM.</p>

          </div>
        
          <div class="ui tab segment lab" data-tab="Solutions">
            <h1>Solutions</h1>
<p>The solution to the ShopV5.0 exercise <a href="archives/ShopV5.0.zip">is here</a>.</p>
<p>The solution to DVD phase 3 <a href="archives/DVDLibraryV3.0.zip">is here</a>.</p>

          </div>
        
      </div>
    </div>
  </div>


  <br>
  <script>
    $(document).on('keydown', function(e) {
  e = e || window.event;
  var nextTab;
  switch (e.which || e.keyCode) {
    case 37: // left
      nextTab = $('.tab-menu a[data-tab].active').prev('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').last();
      nextTab.click();
      $('.pusher').focus();
      break;

    case 39: // right
      nextTab = $('.tab-menu a[data-tab].active').next('a[data-tab]');
      if (!nextTab.length) nextTab = $('.tab-menu a[data-tab]').first();
      nextTab.click();
      $('.pusher').focus();
      break;
  }
});

    $(document).ready(function() {
  $('img').addClass('ui image');

  $('.ui.embed').embed();

  const $images = $('.lab img');
  jQuery.each($images, function(i) {
    if ($images[i].alt.length > 0) {
      const divImg = $(document.createElement('div')).addClass(
        'ui basic segment',
      );
      $($images[i]).wrap(divImg);
      const divLabel = $(document.createElement('div')).addClass(
        'ui blue ribbon label',
      );
      divLabel.append($images[i].alt);
      $(divLabel).insertBefore($images[i]);
    }
  });

  $('.ui.menu .item').tab({
    history: true,
    historyType: 'hash',
  });

  $('.popup').popup();

  $('.ui.sidebar')
    .sidebar({ context: $('.pushable') })
    .sidebar('setting', 'transition', 'slide out')
    .sidebar('attach events', '#toc');
});

  </script>



  <div class="ui bottom fixed borderless right menu">
    <div class="ui right small menu">
      <div class="ui tiny basic message segment">
         Powered by <a href="https://github.com/edeleastar/tutors-ts">tutors-ts.</a> Unless otherwise stated, this work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>
  </div>

  </body>

</html>